---
title: "Computational musicology"
author: "Danielle Jong"
date:   'February--March 2020'
output: 
    flexdashboard::flex_dashboard:
        storyboard: true
        theme: cerulean
---

```{r setup}
library(tidyverse)
library(plotly)
library(spotifyr)
library(compmus)
source('spotify.R')
```

### Sweet Caroline Cepstrogram (week 9)

```{r}
sweet_caroline <- 
    get_tidy_audio_analysis('3298yRJKPcCndQdNiTZKIo') %>% 
    compmus_align(beats, segments) %>% 
    select(beats) %>% unnest(beats) %>% 
    mutate(
        pitches = 
            map(segments, 
                compmus_summarise, pitches, 
                method = 'mean', norm = 'euclidean')) %>% 
    mutate(
        timbre = 
            map(segments, 
                compmus_summarise, timbre, 
                method = 'mean', norm= 'euclidean'))

sweet_caroline %>% 
    compmus_gather_timbre %>% 
    ggplot(
        aes(
            x = start + duration / 2, 
            width = duration, 
            y = basis, 
            fill = value)) + 
    geom_tile() +
    labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') +
    scale_fill_viridis_c(option = 'C') +
    theme_classic()+
  ggtitle ('Sweet Caroline timbre')
```

***

**Findings**

This plot shows the timbre of 'Sweet Caroline', which is an outlier in the plot of week 7. As we can see it has almost an aba'ba''b structure. This is what you might expect when looking at popmusic. Since a lot of popsongs are structured like this.So this doesn't really explain what makes this song so different from other songs.

### Sweet Caroline self-similarity matrix (week 9, 1)

```{r}
sweet_caroline %>% 
    compmus_self_similarity(timbre, 'cosine') %>% 
    ggplot(
        aes(
            x = xstart + xduration / 2, 
            width = xduration,
            y = ystart + yduration / 2,
            height = yduration,
            fill = d)) + 
    geom_tile() +
    coord_fixed() +
    scale_fill_viridis_c(option = 'A', guide = 'none') +
    theme_classic() +
    labs(x = '', y = '')+
  ggtitle('Sweet Caroline timbre (2)')
```

***

**Findings**

When we look at this chromagram, we kind of see the same as in the previous plot. We can still see the ababab-structure, but the third a seems to be very different when comparing it to the other a-sections. In this plot it's easier to see that this part is not only shorter than the other a-sections, but that it also looks a lot like the b-sections. So this a-section might be why Sweet Caroline is an outlier. 

### Sweet Caroline chromagram (week 9, 2)

```{r}
sweet_caroline %>% 
  mutate(pitches = map(pitches, compmus_normalise, 'euclidean')) %>% 
  compmus_gather_chroma %>% 
  ggplot(
    aes(
      x = start + duration / 2, 
      width = duration, 
      y = pitch_class, 
      fill = value)) + 
  geom_tile() +
  labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') +
  theme_minimal()+
  ggtitle('Sweet Caroline pitches')
```

***

**Findings**

When looking at this chromagram we see that this song is mostly in e minor. This is a bit strange if we look into the plot of week 7 where it says that the song is in major. You might expect 'happy songs' to be in major, but this song proves that there are also 'happy songs' in minor (if there is no mistake made in this chromagram).

### Kiss somebody cepstrogram (week 9, 3)

```{r}
kiss_somebody <- 
  get_tidy_audio_analysis('17XU1PTSv4OfcBUE8rNYWm') %>% 
  compmus_align(beats, segments) %>% 
  select(beats) %>% unnest(beats) %>% 
  mutate(
    pitches = 
      map(segments, 
          compmus_summarise, pitches, 
          method = 'mean', norm = 'euclidean')) %>% 
  mutate(
    timbre = 
      map(segments, 
          compmus_summarise, timbre, 
          method = 'mean', norm = 'euclidean'))

kiss_somebody %>% 
  compmus_gather_timbre %>% 
  ggplot(
    aes(
      x = start + duration / 2, 
      width = duration, 
      y = basis, 
      fill = value)) + 
  geom_tile() +
  labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') +
  scale_fill_viridis_c(option = 'C') +
  theme_classic()+
  ggtitle('Kiss somebody timbre')
```

***

**Findings**

This cepstrogram is about 'kiss somebody' which is a 'typical happy song' acoording to the plot of week 7. It doesn't really show a clear structure when we look at c02, but when we look at c03 it looks like the songs is through-composed. There is no clear structure to be seen, since there are mostly purple and yellow beats with almost the same structre, but not as much the same so we can say there's a clear structure. When we compare this ceptrogram to the cepstrogram of Sweet Caroline we see that there's definitly a difference in structure. This is something you probably wouldn't expect, since we're still working with popmusic.

### Kiss somebody chromagram (week 9, 4)

```{r}
kiss_somebody %>% 
  mutate(pitches = map(pitches, compmus_normalise, 'euclidean')) %>% 
  compmus_gather_chroma %>% 
  ggplot(
    aes(
      x = start + duration / 2, 
      width = duration, 
      y = pitch_class, 
      fill = value)) + 
  geom_tile() +
  labs(x = 'Time (s)', y = NULL, fill = 'Magnitude') +
  theme_minimal()+
  ggtitle('Kiss somebody pitches')
```

***

**Findings**

When we take a look at this chromagram we don't see a really clear (musical) pattern. I feel like the chromagram should be moved up by a semitone. This will show d,e,g and c as the most used pitches, which looks a lot like a c major chord. This corresponds to the plots of week 8, where we already found that most (happy) songs are in c. So this is what you might expect. 

### What is a 'happy' playlist? (week 6)

**Introduction**

What I would like to examine is ‘What does it mean to be a ‘happy’ playlist?’ or ‘What makes a playlist ‘happy’ if you compare it to playlists with negative emotions in the title?’

What I am going to do is comparing playlists with ‘happy’ in the title to playlists that have opposite emotions in the title (e.g. sad). My corpus consist out of three playlists with the ‘happy’ in the title. Two playlists exist out of 100 songs and the other one out of 80. The other part of the corpus exist out of two playlists (‘Life sucks’ and ‘Sad songs’) which contain 100 and 60 songs. So the corpus represents playlists that are meant to be ‘happy’ and playlists that are not meant to be ‘happy’. The label ‘happy’ is chosen by Spotify so it represents that label well, but the other playlists are chosen by me and I feel like these playlists are the opposite of ‘happy’, but since it is not chosen by Spotify it might be that these labels overlap or are not related at all. 


***

**First findings**

There seems to be a significantly difference in energy for ‘happy’ playlists and the other Playlists. The happy playlists are more energetic than the other ones (M= .66, SD= .14). The energy level of the other playlists is rather low (M= .31, SD= .14). This seems to be a promising feature for identifying differences between 'Happy'playlists and playlists that are not. Other promising features are:

There’s a significantly difference in valence between the ‘happy’ playlists and the others. The ‘happy’ playlists have a much higher valence (M= .54, SD= .18). The valence for ‘Sad songs’ and ‘Life sucks’ is very low (M= .28, SD= .13).

The mean for the dancebility of the sad songs is at least 0.64 and the other playlists are lower (both 0.51). So ‘happy’ playlists have a higher danceability, but the difference is small. 

What is remarkable is that there doesn’t really seem to be a difference in the mode. They are all mostly major. I expected there to be a difference. The happy songs (M= .66, SD= .48) in major and the other playlists (M= .78, SD= .42) in minor, but that is'nt the case.

There aren't any extremes or outliers in my corpus, so I do not have to think about including or excluding any of them.


### Happy playlists are more energetic than opposite playlists (week 7)

```{r}
happy_tunes <- get_playlist_audio_features('spotify', '37i9dQZF1DX9u7XXOp0l5L')
happy_hits <- get_playlist_audio_features('spotify', '37i9dQZF1DXdPec7aLTmlC')
happy_pop<- get_playlist_audio_features('spotify', '37i9dQZF1DX1H4LbvY4OJi')
life_sucks<- get_playlist_audio_features('spotify', '37i9dQZF1DX3YSRoSdA634')
sad_songs<- get_playlist_audio_features('spotify','37i9dQZF1DX7qK8ma5wgG1')

happy_playlists <-
  happy_tunes %>% mutate(playlist = "Happy tunes") %>%
  bind_rows(happy_hits %>% mutate(playlist = "Happy hits"))%>%
  bind_rows(happy_pop %>% mutate(playlist = "Happy pop"))

opposite_playlists <-
  life_sucks %>% mutate(playlist = "Life sucks") %>%
  bind_rows(sad_songs %>% mutate(playlist = "Sad songs"))

Happy_Sad <-
  happy_playlists %>% mutate(playlist = "Happy playlists") %>%
  bind_rows(opposite_playlists %>% mutate(playlist = "Opposite playlists"))

playslists_plot <- Happy_Sad %>%                       # Start with awards.
  mutate(
    mode = ifelse(mode == 0, 'Minor', 'Major')
  ) %>%
  ggplot(                      # Set up the plot.
    aes(
      x = valence,
      y = energy,
      size = liveness,
      colour = mode,
      label=track.name
          )
  ) +
  geom_point() +               # Scatter plot.
  facet_wrap(~ playlist) +     # Separate charts per playlist.
  scale_x_continuous(          # Fine-tune the x axis.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),  # Use grid-lines for quadrants only.
    minor_breaks = NULL      # Remove 'minor' grid-lines.
  ) +
  scale_y_continuous(          # Fine-tune the y axis in the same way.
    limits = c(0, 1),
    breaks = c(0, 0.25, 0.50,0.75, 1),
    minor_breaks = NULL
  ) +
  scale_colour_brewer(         # Use the Color Brewer to choose a palette.
    type = "qual",           # Qualitative set.
    palette = "Paired"       # Name of the palette is 'Paired'.
  ) +
  scale_size_continuous(       # Fine-tune the sizes of each point.
    trans = "exp",           # Use an exp transformation to emphasise loud.
    guide = "none"           # Remove the legend for size.
  ) +
  theme_light() +              # Use a simpler them.
  labs(                        # Make the titles nice.
    x = "Valence",
    y = "Energy",
    colour = "Mode"
  )+
  ggtitle('Valence, energy, liveness and mode')

ggplotly(playslists_plot)
```

***

**Findings**

This plot is about the valence, energy, liveness and mode of the two kinds of playlists. It is based on the plot of Dr John Ashley Burgoyne that was showed in class. I wanted to use different colors from the same package, but I don't know yet how to do that.The plot shows that the valence and energy for most songs in the happy playlists are high, while for the other kind of playlists the valence and energy are low. This is the same pattern as I already saw last week. Another pattern that I saw last week is that there isn't really a difference in the mode of both kind of playlists. What also can be seen in the graph is that 'Happy songs' tend to have a higher liveness, then songs in the other playlists. When I checked this audio feature last week I didn't see that there is such a difference between the playlists(M=.18, SD=.14 for 'Happy' and M=.13, SD=.06). This is something I didn't expect to find, so I would like to investigate this further in the coming weeks.    

Last week I thought there were'nt any outliers, but there seem to be some. I don't think they will effect the results, because there are many songs that aren't outliers. So I won't take the outliers out.

### Most Happy songs are in C (week 8)

```{r}
ggplot(Happy_Sad, aes(x=key))+
  scale_x_continuous(breaks=0:11, labels = c("c", "c#", "d", "d#", "e", "f", "f#", "g", "g#", "a", "a#", "b"))+
  geom_bar(fill='lightpink', color='pink1')+
  facet_wrap(~playlist)+
  theme_minimal()+
    ggtitle('Happy playlists vs. Opposite playlists') 
  ggplot(happy_playlists, aes(x=key))+
    scale_x_continuous(breaks=0:11, labels = c("c", "c#", "d", "d#", "e", "f", "f#", "g", "g#", "a", "a#", "b"))+
    geom_bar(fill='lightcoral', color='indianred2')+
    facet_wrap(~playlist)+
  theme_minimal()+
    ggtitle('The different happy playlists')
  
  ggplot(opposite_playlists, aes(x=key))+
    scale_x_continuous(breaks=0:11, labels = c("c", "c#", "d", "d#", "e", "f", "f#", "g", "g#", "a", "a#", "b"))+
    geom_bar(fill='hotpink4', color='deeppink4')+
    facet_wrap(~playlist)+
  theme_minimal()+
    ggtitle('The diffent opposite playlists')
  ```
 
   ***

**Findings**
    
In this part I added three graphs that are about the playlists. The first graphs you can see are about the difference between 'happy playlists' and the other kinds of playlists. There you can see that most songs are in c or c sharp. That is to be expected since c is a 'basic' key in music theory. What is remarkable is that the distribution in the middle section of the 'happy playlists' barchart is very high. There aren't really any big differences in mode, while as you look at the barchart of the opposite playlists you see that not everything is (almost) the same. There is more variety in there, but this also doesn't show a very big difference. 

When we take a closer look at the different kinds of 'happy playslist' we see there are three different distributions for every playlist, but they do show some similarities. For example Happy pop and Happy tunes don't have a lot of songs in d sharp, but do have a lot of songs in b and f sharp. When we compare Happy pop to Happy hits their shape is almost the same, but Happy hits contains a lot more song in g than does Happy pop.That they look so much the same might be due to that they contain the same (kind of) songs, but that is something I want to look at in the future weeks. Something that also can be seen in all of these graphs is that all the playlists contain a lot of songs in c. That is the same as we saw earlier when comparing all the Happy playlists to all the other playlists.

Now take a look at the third set of graphs that compare 'Life sucks' to 'Sad songs'. Again most songs are in c, but what we can see now as well is that 'Sad songs' contains a lot of songs in every key, only the c stands out, but not as much as in the other graphs. From this graph we can conclude that sad songs are written in any key, but we must look at more playlists that are 'sad' to conclude it for the label of 'sad' that spotify uses. When we look at 'Life sucks' we see a graph that is comparable to the happy playlists. C stands out again and there also aren't much songs in d sharp, just as the 'Happy pop' and 'Happy tunes' playlists. When we look at the middle section, the amount of songs per key is almost the same, but higher than for most keys in the last section. The last section shows the same pattern, but with less songs per key. 

Overall, we can conclude that all playlists are mostly in c and that d sharp is not used often in these playlists. We can also conclude that there doesn't really seem to be a difference in mode per kind of playlist. So what makes a 'Happy playlist' happy doesn't lie in the key that is used.
  
### What to find out for the coming weeks

* Learn how to change the colors in the graph of week 7 and in the chromagrams of week 9.

* Incorporate ggplotly in my graphs from week 8 (and making different tabs to show all of the graphs)

*  Investigate the 'liveness' of happy songs according to the findings of week 7.

* Look at the different (kind of) songs that are used in the 'Happy pop' and 'Happy hits' playlists to see if they overlap in some kind of way.

* Make my dashboard more user friendly (e.g. adjusting the chart sizes and make several graphs on a tab more accesible).